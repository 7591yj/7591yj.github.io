---
// Animated NixOS logo — stroke-dashoffset draw on scroll
// SVG source: https://brand.nixos.org
---

<div class="nixos-logo-wrap">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="-2150 -1996 9124 3992"
    role="img"
    aria-label="NixOS logo"
  >
    <defs>
      <linearGradient
        gradientUnits="userSpaceOnUse"
        id="nix-grad-a"
        x1="-319.9999999999999" x2="127.99999999999996"
        y1="-554.2562584220408" y2="221.70250336881628"
      >
        <stop offset="0%"   stop-color="#3e5993" />
        <stop offset="25%"  stop-color="#4564a5" />
        <stop offset="100%" stop-color="#4d6fb7" />
      </linearGradient>
      <linearGradient
        gradientUnits="userSpaceOnUse"
        id="nix-grad-b"
        x1="-319.9999999999999" x2="127.99999999999996"
        y1="-554.2562584220408" y2="221.70250336881628"
      >
        <stop offset="0%"   stop-color="#6d9bbc" />
        <stop offset="25%"  stop-color="#72a9cf" />
        <stop offset="100%" stop-color="#77b6e1" />
      </linearGradient>
    </defs>

    <!-- Snowflake: 6 arms rotated 60° apart -->
    <polygon class="nixos-arm" data-stroke="#4564a5"
      fill="url(#nix-grad-a)"
      points="-303.9999999999999 -304.8409421321224 -175.9999999999999 -526.5434455009388 384.00000000000006 443.40500673763256 128.00000000000006 443.40500673763256 -4.072608916703642e-14 221.70250336881628 -128.00000000000023 443.40500673763245 -256.0000000000002 443.40500673763245 -320.0000000000002 332.55375505322434 -128.0 0.0"
      transform="translate(-319.9999999999999 554.2562584220408) rotate(0 319.9999999999999 -554.2562584220408)"
    />
    <polygon class="nixos-arm" data-stroke="#72a9cf"
      fill="url(#nix-grad-b)"
      points="-303.9999999999999 -304.8409421321224 -175.9999999999999 -526.5434455009388 384.00000000000006 443.40500673763256 128.00000000000006 443.40500673763256 -4.072608916703642e-14 221.70250336881628 -128.00000000000023 443.40500673763245 -256.0000000000002 443.40500673763245 -320.0000000000002 332.55375505322434 -128.0 0.0"
      transform="translate(-319.9999999999999 554.2562584220408) rotate(60 319.9999999999999 -554.2562584220408)"
    />
    <polygon class="nixos-arm" data-stroke="#4564a5"
      fill="url(#nix-grad-a)"
      points="-303.9999999999999 -304.8409421321224 -175.9999999999999 -526.5434455009388 384.00000000000006 443.40500673763256 128.00000000000006 443.40500673763256 -4.072608916703642e-14 221.70250336881628 -128.00000000000023 443.40500673763245 -256.0000000000002 443.40500673763245 -320.0000000000002 332.55375505322434 -128.0 0.0"
      transform="translate(-319.9999999999999 554.2562584220408) rotate(120 319.9999999999999 -554.2562584220408)"
    />
    <polygon class="nixos-arm" data-stroke="#72a9cf"
      fill="url(#nix-grad-b)"
      points="-303.9999999999999 -304.8409421321224 -175.9999999999999 -526.5434455009388 384.00000000000006 443.40500673763256 128.00000000000006 443.40500673763256 -4.072608916703642e-14 221.70250336881628 -128.00000000000023 443.40500673763245 -256.0000000000002 443.40500673763245 -320.0000000000002 332.55375505322434 -128.0 0.0"
      transform="translate(-319.9999999999999 554.2562584220408) rotate(180 319.9999999999999 -554.2562584220408)"
    />
    <polygon class="nixos-arm" data-stroke="#4564a5"
      fill="url(#nix-grad-a)"
      points="-303.9999999999999 -304.8409421321224 -175.9999999999999 -526.5434455009388 384.00000000000006 443.40500673763256 128.00000000000006 443.40500673763256 -4.072608916703642e-14 221.70250336881628 -128.00000000000023 443.40500673763245 -256.0000000000002 443.40500673763245 -320.0000000000002 332.55375505322434 -128.0 0.0"
      transform="translate(-319.9999999999999 554.2562584220408) rotate(240 319.9999999999999 -554.2562584220408)"
    />
    <polygon class="nixos-arm" data-stroke="#72a9cf"
      fill="url(#nix-grad-b)"
      points="-303.9999999999999 -304.8409421321224 -175.9999999999999 -526.5434455009388 384.00000000000006 443.40500673763256 128.00000000000006 443.40500673763256 -4.072608916703642e-14 221.70250336881628 -128.00000000000023 443.40500673763245 -256.0000000000002 443.40500673763245 -320.0000000000002 332.55375505322434 -128.0 0.0"
      transform="translate(-319.9999999999999 554.2562584220408) rotate(300 319.9999999999999 -554.2562584220408)"
    />

    <!-- NixOS text: N i x O S -->
    <g transform="translate(1152.0 665.1075101064489)">
      <path class="nixos-letter" fill="black"
        d="M 1251.517578125 -1331.0 L 1406.517578125 -1331.0 L 1406.517578125 0.0 L 1258.517578125 0.0 L 514.517578125 -1055.0 L 514.517578125 0.0 L 359.517578125 0.0 L 359.517578125 -1331.0 L 507.517578125 -1331.0 L 1251.517578125 -275.0"
      />
      <path class="nixos-letter" fill="black"
        d="M 1726.30078125 -1144.0 L 1726.30078125 -1289.0 C 1686.30078125 -1300.0 1608.30078125 -1300.0 1568.30078125 -1289.0 L 1568.30078125 -1144.0 C 1608.30078125 -1133.0 1686.30078125 -1133.0 1726.30078125 -1144.0 M 1726.30078125 0.0 L 1726.30078125 -935.0 L 1568.30078125 -953.0 L 1568.30078125 0.0"
      />
      <path class="nixos-letter" fill="black"
        d="M 2688.1318359375 -935.0 L 2351.1318359375 -480.0 L 2686.1318359375 0.0 L 2493.1318359375 0.0 L 2263.1318359375 -370.0 L 2035.1318359375 0.0 L 1852.1318359375 0.0 L 2186.1318359375 -467.0 L 1868.1318359375 -935.0 L 2062.1318359375 -935.0 L 2270.1318359375 -574.0 L 2497.1318359375 -935.0"
      />
      <path class="nixos-letter" fill="black"
        d="M 3389.0107421875 -1356.0 C 3722.0107421875 -1356.0 4000.0107421875 -1113.0 4000.0107421875 -665.0 C 4000.0107421875 -217.0 3722.0107421875 25.0 3389.0107421875 25.0 C 3056.0107421875 25.0 2778.0107421875 -217.0 2778.0107421875 -665.0 C 2778.0107421875 -1113.0 3056.0107421875 -1356.0 3389.0107421875 -1356.0 M 3389.0107421875 -111.0 C 3655.0107421875 -111.0 3824.0107421875 -332.0 3824.0107421875 -665.0 C 3824.0107421875 -998.0 3655.0107421875 -1219.0 3389.0107421875 -1219.0 C 3123.0107421875 -1219.0 2954.0107421875 -998.0 2954.0107421875 -665.0 C 2954.0107421875 -332.0 3123.0107421875 -111.0 3389.0107421875 -111.0"
      />
      <path class="nixos-letter" fill="black"
        d="M 4371.9873046875 25.0 C 4240.9873046875 25.0 4098.9873046875 -9.0 4017.9873046875 -88.0 L 4089.9873046875 -203.0 C 4174.9873046875 -147.0 4276.9873046875 -119.0 4377.9873046875 -119.0 C 4530.9873046875 -119.0 4648.9873046875 -185.0 4648.9873046875 -325.0 C 4648.9873046875 -447.0 4560.9873046875 -519.0 4357.9873046875 -638.0 C 4202.9873046875 -728.0 4082.9873046875 -823.0 4082.9873046875 -1012.0 C 4082.9873046875 -1228.0 4256.9873046875 -1356.0 4506.9873046875 -1356.0 C 4610.9873046875 -1356.0 4702.9873046875 -1336.0 4785.9873046875 -1287.0 L 4731.9873046875 -1167.0 C 4666.9873046875 -1201.0 4571.9873046875 -1212.0 4494.9873046875 -1212.0 C 4338.9873046875 -1212.0 4251.9873046875 -1147.0 4251.9873046875 -1034.0 C 4251.9873046875 -923.0 4330.9873046875 -840.0 4459.9873046875 -764.0 C 4698.9873046875 -624.0 4824.9873046875 -531.0 4824.9873046875 -340.0 C 4824.9873046875 -99.0 4621.9873046875 25.0 4371.9873046875 25.0"
      />
    </g>
  </svg>
</div>

<script>
  function setupNixOSLogos() {
    document
      .querySelectorAll<HTMLElement>(".nixos-logo-wrap:not([data-ready])")
      .forEach((wrap) => {
        wrap.setAttribute("data-ready", "");

        const arms    = wrap.querySelectorAll<SVGGeometryElement>(".nixos-arm");
        const letters = wrap.querySelectorAll<SVGGeometryElement>(".nixos-letter");

        // Prime each element with its full perimeter as the dash gap
        [...arms, ...letters].forEach((el) => {
          const len = el.getTotalLength();
          el.style.strokeDasharray  = String(len);
          el.style.strokeDashoffset = String(len);
          // Read stroke color from data attribute (arms differ per gradient)
          const stroke = el.dataset.stroke ?? "currentColor";
          el.style.stroke = stroke;
        });

        const io = new IntersectionObserver(
          ([entry]) => {
            if (!entry.isIntersecting) return;
            io.disconnect();

            // Snowflake arms: draw one by one, then fill fades in
            arms.forEach((arm, i) => {
              const drawDelay = i * 90;
              const fillDelay = drawDelay + 450;
              arm.style.transition = [
                `stroke-dashoffset 480ms ease ${drawDelay}ms`,
                `fill-opacity 380ms ease ${fillDelay}ms`,
                `stroke-opacity 300ms ease ${fillDelay + 200}ms`,
              ].join(", ");
              arm.style.strokeDashoffset = "0";
              arm.style.fillOpacity      = "1";
              arm.style.strokeOpacity    = "0";
            });

            // Letters: draw after snowflake, then fill fades in
            letters.forEach((letter, i) => {
              const drawDelay = 620 + i * 80;
              const fillDelay = drawDelay + 380;
              letter.style.transition = [
                `stroke-dashoffset 420ms ease ${drawDelay}ms`,
                `fill-opacity 320ms ease ${fillDelay}ms`,
                `stroke-opacity 280ms ease ${fillDelay + 180}ms`,
              ].join(", ");
              letter.style.strokeDashoffset = "0";
              letter.style.fillOpacity      = "1";
              letter.style.strokeOpacity    = "0";
            });
          },
          { threshold: 0.3 }
        );

        io.observe(wrap);
      });
  }

  setupNixOSLogos();
  document.addEventListener("astro:page-load", setupNixOSLogos);
</script>

<style>
  .nixos-logo-wrap {
    max-width: 480px;
    margin-inline: auto;
  }

  .nixos-logo-wrap svg {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Initial state: invisible fill, stroke ready to animate */
  .nixos-arm {
    fill-opacity: 0;
    stroke-opacity: 1;
    stroke-width: 28;
    stroke-linejoin: round;
  }

  .nixos-letter {
    fill-opacity: 0;
    stroke-opacity: 1;
    stroke: #1a1a1a;
    stroke-width: 28;
    stroke-linejoin: round;
    stroke-linecap: round;
  }

  /* Dark background: switch to white-text variant (matches the official white logo) */
  :global([data-theme="dark"]) .nixos-letter {
    fill: white;
    stroke: #ececec;
  }
</style>
