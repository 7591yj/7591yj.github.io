---
import { ViewTransitions } from "astro:transitions";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";
import { Font } from "astro:assets";
import { SITE_NAME } from "../consts";

interface Props {
  title?: string;
  transparentHeader?: boolean;
}

const { title = SITE_NAME, transparentHeader = false } = Astro.props;
---

<Font cssVariable="--font-shippori" preload />

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <ViewTransitions />
    <script is:inline define:vars={{ THEME_KEY: "theme" }}>
      (function () {
        const stored = localStorage.getItem(THEME_KEY);
        const systemDark = window.matchMedia(
          "(prefers-color-scheme: dark)",
        ).matches;
        const theme =
          stored === "system" || !stored
            ? systemDark
              ? "dark"
              : "light"
            : stored;
        document.documentElement.setAttribute("data-theme", theme);
      })();
    </script>
  </head>
  <body>
    <Header transparentHeader={transparentHeader} />
    <slot />
    <Footer />
    <script src="../scripts/scroll-animate.ts"></script>
    <script src="../scripts/header-scroll.ts"></script>
    <script src="../scripts/scramble-text.ts"></script>
    <script>
      import { initTheme, watchSystemPreference } from "../scripts/theme";
      watchSystemPreference();
      document.addEventListener("astro:page-load", () => {
        initTheme();
      });
    </script>
  </body>
</html>
<style>
  body {
    font-family: "PlemolJP", monospace;
  }
</style>
